<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>身長×体重 → 体型シルエット（完成版：塗りつぶし＋腕スケール／複数人）</title>
<style>
  :root{
    --bg:#0f1115; --panel:#1a1f29; --text:#e7eaf0; --muted:#9aa3b2; --border:#263149;
    --ok:#6ee7a8; --info:#64b5f6; --warn:#fbbf24; --bad:#f87171; --w:1100px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0e121a,#0a0d13 60%);color:var(--text);
       font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;
       display:flex;flex-direction:column;align-items:center;gap:20px;padding:28px 16px 60px}
  h1{font-size:20px;margin:0 0 6px}
  .card{width:100%;max-width:var(--w);background:var(--panel);border:1px solid #232b3a;border-radius:14px;overflow:hidden;box-shadow:0 12px 40px rgba(0,0,0,.3)}
  .pane{padding:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .pane + .pane{border-left:1px solid #232b3a}
  label{display:block;font-weight:600;margin:10px 0 6px}
  input[type="number"],select,input[type="text"]{width:100%;background:#0f1420;color:var(--text);
       border:1px solid #273044;border-radius:10px;padding:10px 12px;outline:none}
  input[type="range"],input[type="color"]{width:100%}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
        font-weight:700;background:#0f1420;border:1px solid #273044;color:var(--muted)}
  .pill.ok{border-color:#174c3a;background:#0c1a15;color:var(--ok)}
  .pill.warn{border-color:#4a3b13;background:#1a1407;color:var(--warn)}
  .pill.bad{border-color:#4a1717;background:#1a0c0c;color:var(--bad)}
  .big{font-size:20px;font-weight:800}
  .canvas-wrap{position:relative;width:100%;aspect-ratio:16/9;background:linear-gradient(to top,#0c111b,#0b1019);
               border-radius:12px;border:1px solid var(--border);overflow:hidden}
  svg{width:100%;height:100%}
  .scale{position:absolute;right:8px;bottom:8px;color:#9aa3b2;font-size:11px;background:rgba(0,0,0,.35);
         padding:4px 6px;border-radius:6px;border:1px solid #2a3346}
  .btn{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;color:#0c121a;background:var(--info)}
  .who{font-weight:800;letter-spacing:.02em}
  .note{font-size:12px;color:var(--muted);margin-top:8px}
  .foot{color:#8090a9;font-size:12px;opacity:.9;text-align:center}
</style>
</head>
<body>
  <div class="card">
    <div class="pane">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <h1>身長×体重 → 体型シルエット（塗りつぶし＋腕スケール／複数人）</h1>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="btn" id="addBtn" title="人を追加">＋ 人を追加</button>
          <label for="gap" style="font-size:12px;color:var(--muted);margin-top:4px">二人の距離（中心間）</label>
          <input id="gap" type="range" min="120" max="520" value="340">
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <!-- Person A -->
        <div class="pane" id="paneA">
          <div class="who">人物A</div>
          <div class="grid">
            <div><label for="nameA">名前</label><input id="nameA" type="text" value="A"></div>
            <div><label for="sexA">体型</label><select id="sexA"><option value="f">女性寄り</option><option value="m">男性寄り</option><option value="n" selected>ニュートラル</option></select></div>
            <div><label for="heightA">身長(cm)</label><input id="heightA" type="number" min="120" max="230" step="0.1" value="165"></div>
            <div><label for="weightA">体重(kg)</label><input id="weightA" type="number" min="30" max="200" step="0.1" value="55"></div>
            <div><label for="muscleA">ムキ度（ガリ↔ムキ）</label><input id="muscleA" type="range" min="-100" max="100" value="0"></div>
            <div><label for="colorA">色</label><input id="colorA" type="color" value="#6ee7a8"></div>
          </div>
          <div class="pill" id="bmiPillA">BMI <span class="big" id="bmiValA">—</span></div>
        </div>

        <!-- Person B -->
        <div class="pane" id="paneB">
          <div class="who">人物B</div>
          <div class="grid">
            <div><label for="nameB">名前</label><input id="nameB" type="text" value="B"></div>
            <div><label for="sexB">体型</label><select id="sexB"><option value="f">女性寄り</option><option value="m" selected>男性寄り</option><option value="n">ニュートラル</option></select></div>
            <div><label for="heightB">身長(cm)</label><input id="heightB" type="number" min="120" max="230" step="0.1" value="175"></div>
            <div><label for="weightB">体重(kg)</label><input id="weightB" type="number" min="30" max="200" step="0.1" value="68"></div>
            <div><label for="muscleB">ムキ度（ガリ↔ムキ）</label><input id="muscleB" type="range" min="-100" max="100" value="0"></div>
            <div><label for="colorB">色</label><input id="colorB" type="color" value="#64b5f6"></div>
          </div>
          <div class="pill" id="bmiPillB">BMI <span class="big" id="bmiValB">—</span></div>
        </div>
      </div>

      <div id="extrasPanes" class="row" style="margin-top:8px"></div>

      <div class="pane" style="border-top:1px solid #232b3a;margin-top:8px;padding-top:12px">
        <div class="canvas-wrap">
          <svg id="fig" viewBox="-550 0 1100 900" aria-label="体型シルエット" role="img">
            <g id="grid"></g>
            <g id="floor"></g>
            <g id="personA"></g>
            <g id="personB"></g>
            <g id="extras"></g>
          </svg>
          <div class="scale" id="scaleText">—</div>
        </div>
        <div class="note">AB｜CD｜EF… の<strong>ペア並び</strong>（B と C は寄らない）。胴体は塗りつぶし、腕は体型スケール連動。</div>
      </div>
    </div>
  </div>
  <div class="foot">© 完成版 Silhouette</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const $ = id => document.getElementById(id); // ローカル用途のみに限定

  const el = {
    nameA:$('nameA'), sexA:$('sexA'), heightA:$('heightA'), weightA:$('weightA'), muscleA:$('muscleA'), colorA:$('colorA'),
    nameB:$('nameB'), sexB:$('sexB'), heightB:$('heightB'), weightB:$('weightB'), muscleB:$('muscleB'), colorB:$('colorB'),
    gap:$('gap'), fig:$('fig'), grid:$('grid'), floor:$('floor'), personA:$('personA'), personB:$('personB'), extras:$('extras'),
    scale:$('scaleText'), addBtn:$('addBtn'), extrasPanes:$('extrasPanes'),
    bmiValA:$('bmiValA'), bmiValB:$('bmiValB'), bmiPillA:$('bmiPillA'), bmiPillB:$('bmiPillB')
  };

  // --- Utils ---
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const lerp=(a,b,t)=>a+(b-a)*t;
  const pxPerCm=(maxH)=>740/Math.max(150,maxH);

  const base={
    f:{shoulder:.215,waist:.140,hip:.225,thigh:.140,calf:.085,arm:.110},
    m:{shoulder:.230,waist:.160,hip:.205,thigh:.150,calf:.095,arm:.120},
    n:{shoulder:.222,waist:.150,hip:.215,thigh:.145,calf:.090,arm:.115}
  };

  const bmiCat = (b)=> b<18.5?{cls:'warn'}: b<25?{cls:'ok'}: b<30?{cls:'warn'}:{cls:'bad'};
  const pillCol = {ok:'var(--ok)', warn:'var(--warn)', bad:'var(--bad)'};

  function build(H,W,sex){
    H=clamp(+H||0,120,230); W=clamp(+W||0,30,200);
    const bmi=W/Math.pow(H/100,2);
    return {H,W,bmi,cat:bmiCat(bmi),prof:base[sex]||base.n};
  }

  function widths(F,mus){
    const k=(F.bmi-22);
    const adj=clamp(k,-6,12)*0.004 + (mus||0)*0.02;
    return {
      shoulder: F.H*(F.prof.shoulder + adj*1.0),
      waist:    F.H*(F.prof.waist   - adj*0.7),
      hip:      F.H*(F.prof.hip     + adj*0.6),
      thigh:    F.H*(F.prof.thigh   + adj*0.8),
      calf:     F.H*(F.prof.calf    + adj*0.6),
      arm:      F.H*(F.prof.arm     + adj*0.8)
    };
  }

  function genBody(F,mus,ppcm){
    const pxH=F.H*ppcm, neckY=pxH*0.125;
    const shoulderY=neckY+pxH*0.03,
          waistY   =neckY+pxH*0.30,
          hipY     =neckY+pxH*0.40,
          crotchY  =neckY+pxH*0.47,
          kneeY    =neckY+pxH*0.70,
          footY    =pxH;

    const w=widths(F,mus), toHalf=cm=>(cm*ppcm)/2;
    const hs=toHalf(w.shoulder), hw=toHalf(w.waist), hh=toHalf(w.hip),
          ht=toHalf(w.thigh), hc=toHalf(w.calf), ha=toHalf(w.arm);

    // 左右アウトライン（腕ボリュームを途中で組み込み、面として連続）
    const left=[
      {x:-hs,          y:shoulderY},
      {x:-(hs+ha),     y:shoulderY + pxH*0.25}, // 腕一体
      {x:-hw,          y:waistY},
      {x:-hh,          y:hipY},
      {x:-ht,          y:crotchY},
      {x:-ht,          y:kneeY},
      {x:-hc,          y:(footY-40)},
      {x:-hc*0.8,      y:footY}
    ];
    const right=left.map(p=>({x:-p.x,y:p.y}));

    function toPath(pts){
      let d=`M ${pts[0].x} ${pts[0].y}`;
      for(let i=1;i<pts.length;i++){
        const a=pts[i-1], b=pts[i];
        const cx=lerp(a.x,b.x,.5), cy=lerp(a.y,b.y,.5);
        d+=` Q ${cx} ${cy} ${b.x} ${b.y}`;
      }
      return d;
    }
    return toPath(left)+' '+toPath(right.reverse())+' Z';
  }

  // 腕の太さスケール（BMI & ムキ度）→ シルエットにすでに混ぜ込み済なので、彩度濃さだけ補正
  function armToneScale(m, mus){
    const bmiTerm = clamp((m.bmi-22)/10, -0.6, 1.2);    // -0.6〜1.2
    const musTerm = clamp(mus||0, -1, 1) * 0.8;         // -0.8〜0.8
    const s = 0.32 + bmiTerm*0.06 + musTerm*0.10;       // 塗りの不透明度微調整用
    return clamp(s, 0.18, 0.55);
  }

  function drawOne(g, H,W,sex,color, x, ppcm, mus){
    const model=build(H,W,sex);
    const body=genBody(model,mus,ppcm);
    const fillOpacity = armToneScale(model, mus); // 体型に応じて面の濃さを微調整
    g.setAttribute('transform',`translate(${x},${820 - model.H*ppcm})`);
    g.innerHTML = `<path d="${body}" fill="${color}" fill-opacity="${fillOpacity.toFixed(2)}" stroke="${color}" stroke-opacity="0.40" stroke-width="2.4"/>`;
    return model;
  }

  // グリッド＆床
  function drawGrid(maxH){
    const ppcm=pxPerCm(maxH), yTop=80, yFloor=yTop+740;
    const lines=[];
    for(let cm=0; cm<=250; cm+=10){
      const y=yTop+(cm/maxH)*740, strong=(cm%50===0);
      lines.push(`<line x1="-520" y1="${y.toFixed(1)}" x2="520" y2="${y.toFixed(1)}" stroke="${strong?'#2c3852':'#20283b'}" stroke-width="${strong?1.2:0.6}"/>`);
      if(strong){ lines.push(`<text x="-515" y="${(y-3).toFixed(1)}" fill="#6b7590" font-size="10">${cm}cm</text>`); }
    }
    el.grid.innerHTML = lines.join('');
    el.floor.innerHTML = `
      <rect x="-550" y="${(yFloor-8).toFixed(1)}" width="1100" height="12" fill="#0e1422" opacity="0.9"/>
      <line x1="-550" y1="${yFloor.toFixed(1)}" x2="550" y2="${yFloor.toFixed(1)}" stroke="#5aa2ff" stroke-width="2.5"/>
      <line x1="-550" y1="${(yFloor-3).toFixed(1)}" x2="550" y2="${(yFloor-3).toFixed(1)}" stroke="rgba(255,255,255,.20)" stroke-width="1.2"/>
    `;
    el.scale.textContent = `スケール: 1px ≒ ${(1/ppcm).toFixed(2)}cm`;
    return {ppcm,yFloor};
  }

  // 入力値取得
  function read(prefix){
    return {
      name:  $(`name${prefix}`).value,
      sex:   $(`sex${prefix}`).value,
      H:     parseFloat($(`height${prefix}`).value),
      W:     parseFloat($(`weight${prefix}`).value),
      mus:  (parseInt($(`muscle${prefix}`).value,10)||0)/100,
      color: $(`color${prefix}`).value
    };
  }

  const extras=[]; let extraCount=0;

  function update(){
    const A=read('A'), B=read('B');
    const mA=build(A.H,A.W,A.sex), mB=build(B.H,B.W,B.sex);

    // BMIピル更新
    if(el.bmiValA){ el.bmiValA.textContent=mA.bmi.toFixed(1); el.bmiPillA.style.color=pillCol[mA.cat.cls]; el.bmiPillA.className='pill '+mA.cat.cls; }
    if(el.bmiValB){ el.bmiValB.textContent=mB.bmi.toFixed(1); el.bmiPillB.style.color=pillCol[mB.cat.cls]; el.bmiPillB.className='pill '+mB.cat.cls; }

    const models=[mA,mB,...extras.map(id=>{const d=read(id); return build(d.H,d.W,d.sex);})];
    const maxH=Math.max(250, ...models.map(m=>m.H));
    const {ppcm,yFloor}=drawGrid(maxH);

    const gap = parseInt(el.gap.value||340,10);
    const groupGap = Math.max(180, Math.round(gap*0.9));

    // A/B
    el.personA.setAttribute('transform', `translate(${-gap/2}, 0)`);
    el.personB.setAttribute('transform', `translate(${ gap/2}, 0)`);
    const mA2 = drawOne(el.personA, A.H,A.W,A.sex, A.color||'#6ee7a8', -0, ppcm, A.mus);
    const mB2 = drawOne(el.personB, B.H,B.W,B.sex, B.color||'#64b5f6',  +0, ppcm, B.mus);

    // 縦位置（床合わせ）
    const yA = 820 - mA2.H*ppcm, yB = 820 - mB2.H*ppcm;
    el.personA.setAttribute('transform', `translate(${-gap/2}, ${yA})`);
    el.personB.setAttribute('transform', `translate(${ gap/2}, ${yB})`);

    // 追加分（AB｜CD｜EF… のペア配置）
    el.extras.innerHTML = ''; // 再構築
    let baseX = (gap/2) + groupGap; const stepPair = groupGap + gap;
    extras.forEach((id, idx)=>{
      const d=read(id); const m=build(d.H,d.W,d.sex);
      const Pgroup=document.createElementNS('http://www.w3.org/2000/svg','g');
      Pgroup.setAttribute('id','gx'+id);
      el.extras.appendChild(Pgroup);
      const x = baseX + (Math.floor(idx/2)*stepPair) + ((idx%2)? gap : 0);
      drawOne(Pgroup, d.H,d.W,d.sex, d.color||'#8ab4ff', x, ppcm, d.mus);
      const y = 820 - m.H*ppcm;
      Pgroup.setAttribute('transform', `translate(${x}, ${y})`);
    });
  }

  // 監視
  ['A','B'].forEach(pref=>{
    ['name','sex','height','weight','muscle','color'].forEach(k=>{
      const n=$(`${k}${pref}`); if(n) n.addEventListener('input', update);
    });
  });
  el.gap.addEventListener('input', update);

  function removeExtra(id){
    const i=extras.indexOf(id); if(i>-1) extras.splice(i,1);
    const pane=$('pane'+id); if(pane) pane.remove();
    update();
  }

  function addExtra(){
    extraCount++; const id='X'+extraCount; extras.push(id);
    const pane=document.createElement('div'); pane.className='pane'; pane.id='pane'+id;
    pane.innerHTML=`
      <div class="who">人物${extraCount+2}
        <button class="btn" id="del${id}" style="margin-left:8px;padding:6px 10px">削除</button>
      </div>
      <div class="grid">
        <div><label for="name${id}">名前</label><input id="name${id}" type="text" value="P${extraCount+2}"></div>
        <div><label for="sex${id}">体型</label>
          <select id="sex${id}"><option value="f">女性寄り</option><option value="m">男性寄り</option><option value="n" selected>ニュートラル</option></select>
        </div>
        <div><label for="height${id}">身長(cm)</label><input id="height${id}" type="number" min="120" max="230" step="0.1" value="168"></div>
        <div><label for="weight${id}">体重(kg)</label><input id="weight${id}" type="number" min="30" max="200" step="0.1" value="60"></div>
        <div><label for="muscle${id}">ムキ度</label><input id="muscle${id}" type="range" min="-100" max="100" value="0"></div>
        <div><label for="color${id}">色</label><input id="color${id}" type="color" value="#8ab4ff"></div>
      </div>`;
    el.extrasPanes.appendChild(pane);
    ['name','sex','height','weight','muscle','color'].forEach(k=>$(k+id).addEventListener('input', update));
    $('del'+id).addEventListener('click', ()=>removeExtra(id));
    update();
  }
  el.addBtn.addEventListener('click', addExtra);

  // 初期描画
  update();
});
 </script>
  <a data-ofuse-widget-button href="https://ofuse.me/o?uid=117761" data-ofuse-id="117761" data-ofuse-color="pink" data-ofuse-text="OFUSE・要望（Free）はこちら">OFUSE・要望（Free）はこちら</a><script async src="https://ofuse.me/assets/platform/widget.js" charset="utf-8"></script>
</script>
</body>
</html>

